<html class="x-admin-sm"><head>  <meta charset="UTF-8">  <title>格主退格</title>  <meta name="renderer" content="webkit">  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">  <!--<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />-->  <link rel="stylesheet" href="../../css/font.css">  <link rel="stylesheet" href="../../css/xadmin.css">  <script type="text/javascript" src="../../js/jquery3.2.1.min.js"></script>  <script type="text/javascript" src="../../lib/layui/layui.js" charset="utf-8"></script>  <script type="text/javascript" src="../../js/xadmin.js"></script>  <script type="text/javascript" src="../../js/cookie.js"></script>  <script type="text/javascript" src="../../js/vue.min.js"></script>  <script type="text/javascript" src="../../js/axios.min.js"></script>  <!--<script type="text/javascript" src="../../js/vue-paginate.js"></script>-->  <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->  <!--[if lt IE 9]>  <script src="../../js/html5.min.js"></script>  <script src="../../js/respond.min.js"></script>  <![endif]--></head><body onload="tableCheck.init()"><div class="x-nav" >      <span class="layui-breadcrumb">        <a href="">首页</a>        <a href="">销售管理</a>        <a>          <cite>格主退格</cite></a>      </span>  <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">    <i class="layui-icon" style="line-height:30px">ဂ</i></a></div><div class="x-body" id="record">  <div class="layui-row">    <div class=" layui-col-md12 x-so">      <select class="layui-select" v-model="type">        <option value="">请选择日期类别</option>        <option value="start">租赁日期</option>        <option value="end">到期日期</option>      </select>      <input  class="layui-input"  autocomplete="off" v-show="type.length>0?true:false" placeholder="开始日期" v-model="start" id="start">      <input  class="layui-input"  autocomplete="off" v-show="type.length>0?true:false" placeholder="截止日期" v-model="end" id="end">      <input type="text" v-model="gridName"  placeholder="请输入格子铺名称" autocomplete="off" class="layui-input">      <input type="text" v-model="tenantName"  placeholder="请输入格主姓名" autocomplete="off" class="layui-input">      <button class="layui-btn"  @click="getAll(0)" title="搜索"><i class="layui-icon" >&#xe615;</i></button>      <button class="layui-btn" @click="reset()" title="重置"><i class="layui-icon" >&#xe669;</i></button>    </div>  </div>  <xblock>    <button class="layui-btn layui-btn-disabled">格主退格</button>    <span class="x-right" style="line-height:40px">共有数据：{{this.totalElements}} 条</span>  </xblock>  <table class="x-admin layui-table ">    <thead>    <tr>      <th>ID</th>      <th colspan="3">格子铺信息(ID/名称/大小)</th>      <th colspan="3">格主信息(ID/姓名/手机)</th>      <th>租赁费用</th>      <th>租赁日期</th>      <th>到期日期</th>      <th>状态</th>      <th>操作</th></tr>    </thead>    <tbody id="tbody">    <tr v-for="items in records">      <td lay-sort="true">{{items.id}}</td>      <td>{{items.gridByGridId.id}}</td>      <td>{{items.gridByGridId.name}}</td>      <td>{{items.gridByGridId.size}}</td>      <td>{{items.tenantId}}</td>      <td>{{items.tenantByTenantId.name}}</td>      <td>{{items.tenantByTenantId.phone}}</td>      <td>{{items.fee}}</td>      <td>{{items.date}}</td>      <td>{{items.endDate}}</td>      <td class="td-status">        <span class="layui-btn layui-btn-normal layui-btn-mini" @click="relieve(items)" v-if="items.status">在租赁</span>        <span class="layui-btn layui-btn-danger layui-btn-mini" v-else>已解租</span>      </td>      <td class="td-manage">        <span class="layui-btn layui-btn" @click="relieve(items)" v-if="items.status">解除租赁</span>      </td>    </tr>    </tbody>  </table>  <div class="page" v-show="paginate">    <a @click="getAll(pageNumber-2)">&lt;&lt;</a>    <input  v-model="pageNumber" @change="getAll(pageNumber-1)"/>/    <a>{{totalPages}}</a>    <a @click="getAll(pageNumber)">&gt;&gt;</a>  </div></div><script>    // import Paginate from '../../js/vue-paginate'    // Vue.component('paginate', VuePaginate);    const app = new Vue({        el: "#record",        data: {            // Note 'isActive' is left out and will not appear in the rendered table            records:[],            pageNumber:1,            pageSize:10,            first:'',            last:'',            totalElements:0,            totalPages:1,            gridName:'',            tenantName:'',            status:true,            start:'',            end:'',            type:'',            paginate:true,            pageCount:20,            marginPages:2,            rangePage:5,            initPage:0,        },        // components: {        //   'paginate':VuePaginate        // },        computed:{        },//自动加载        mounted() {            this.getAll(0);            $('#all').html('<div class="layui-unselect layui-form-checkbox header " ' +                'lay-skin="primary"><i class="layui-icon">&#xe605;</i></div>')        },        methods:{            getAll(pages) {                if (pages>-1&&pages<this.totalPages||this.totalPages===0){                    axios.get(urlPrefix+'/rentRecords?token=' + token, {                        params: {                            'page':pages,                            'tenantName':this.tenantName,                            'gridName':this.gridName,                            'start':this.start,                            'end':this.end,                            'status':this.status,                            'type':this.type                        }                    }).then((response) => {                        var r = response.data.data;                    this.records=r.content;                    this.pageNumber=r.number+1;                    this.first=r.first;                    this.last=r.last;                    this.totalElements=r.totalElements;                    this.totalPages=r.totalPages;                    // alert(JSON.stringify(response.data.data))'                    if (this.totalElements<=10){                        this.paginate = false;                    }                }).catch((err) => {                        errHandler(err);                });                }else if (pages<0&&!(this.first&&this.last)){                    layer.msg("已经是首页",{icon:0,time:1000});                } else{                    if (!(this.first&&this.last)) {                        layer.msg("已经是尾页",{icon:0,time:1000});                    }                }            },            reset(){                this.tenantName='';                this.start='';                this.end='';                this.gridName='';                this.type='';            },            relieve(record) {                var now = new Date();                var str = "确认解除租赁吗？";                var end = new Date(record.endDate);                // alert(now+' '+end);                if (now<end) {                    str = "租赁尚未到期，确定要提前解除租赁吗"                }                layer.confirm(str,{icon:0},function () {                    //发异步，把数据提交                    axios.post(urlPrefix+'/grids/relieve?token=' + token,record )                        .then((response) => {                        layer.alert("解除租赁成功", {icon: 6},function () {                        layer.closeAll();                        app.getAll(this.pageNumber-1);                    });                }).catch((err) => {                        errHandler(err);                    layer.alert("解除租赁失败", {icon: 5});                });                });            }        }    });    layui.use('laydate', function(){        var laydate = layui.laydate;        //执行一个laydate实例        laydate.render({            elem: '#start', //指定元素            format:'yyyy-MM-dd',            done:(value)=>{            app.start = value;    }    });        //执行一个laydate实例        laydate.render({            elem: '#end', //指定元素            format:'yyyy-MM-dd',            done:(value)=>{            app.end = value;    }    });    });</script></body></html>
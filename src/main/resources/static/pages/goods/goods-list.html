<html class="x-admin-sm">  <head>    <meta charset="UTF-8">    <title>商品管理</title>    <meta name="renderer" content="webkit">    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    <!--<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />-->    <link rel="stylesheet" href="../../css/font.css">    <link rel="stylesheet" href="../../css/xadmin.css">    <script type="text/javascript" src="../../js/jquery3.2.1.min.js"></script>    <script type="text/javascript" src="../../lib/layui/layui.js" charset="utf-8"></script>    <script type="text/javascript" src="../../js/xadmin.js"></script>    <script type="text/javascript" src="../../js/cookie.js"></script>    <script type="text/javascript" src="../../js/vue.min.js"></script>    <script type="text/javascript" src="../../js/axios.min.js"></script>    <!--<script type="text/javascript" src="../../js/vue-paginate.js"></script>-->    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->    <!--[if lt IE 9]>    <script src="../../js/html5.min.js"></script>    <script src="../../js/respond.min.js"></script>    <![endif]-->  </head>  <body onload="tableCheck.init()">    <div class="x-nav" >      <span class="layui-breadcrumb">        <a href="">首页</a>        <a href="">商品管理</a>        <a>          <cite>商品列表</cite>        </a>      </span>      <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">        <i class="layui-icon" style="line-height:30px">ဂ</i></a>    </div>    <div class="x-body" id="goods">      <div class="layui-row">        <div class=" layui-col-md12 x-so">          <select class="layui-select" v-model="status">            <option selected="selected" value="">请选择商品状态</option>            <option value="true">已上架</option>            <option value="false">已下架</option>          </select>          <input type="text" v-model="name"  placeholder="请输入商品名称" autocomplete="off" class="layui-input">          <input type="text" v-model="gridName"  placeholder="请输入格子铺铺名称" autocomplete="off" class="layui-input">          <button class="layui-btn"  @click="getAll(0)" title="搜索"><i class="layui-icon" >&#xe615;</i></button>          <button class="layui-btn" @click="reset()" title="重置"><i class="layui-icon" >&#xe669;</i></button>        </div>      </div>      <xblock>        <button class="layui-btn layui-btn-danger" @click="delAll()"><i class="layui-icon"></i>批量删除</button>        <button class="layui-btn layui-btn-danger" @click="function() { app.warning=true;app.status=true;app.getAll(0) }">          <i class="layui-icon">&#xe667;</i>库存报警</button>        <button class="layui-btn" onclick="location.href='goods-gridList.html'"><i class="layui-icon"></i>新货上架</button>        <span class="x-right" style="line-height:40px">共有数据：{{this.totalElements}} 条</span>      </xblock>      <div  class="layui-layout-right" id="product_pic" style="  position:absolute;visibility: hidden;"            onmouseover="MM_showHideLayers('product_pic','big','show');"            onmouseout="MM_showHideLayers('product_pic','big','hide');">        <!--鼠标经过的时候显示的图片-->        <img class="right" id="bigpic"  style="height: 500px ;width: 370px" src="">      </div>      <table class="x-admin layui-table ">        <thead>          <tr>            <th id="all">            </th>            <th>预览</th>            <th>ID</th>            <th>条码</th>            <th>名称</th>            <th>数量</th>            <th>单价</th>            <th colspan="2">所属格子铺(ID/名称)</th>            <th>状态</th>            <th>操作</th></tr>        </thead>        <tbody id="tbody">          <tr v-for="items in goods">            <td :id="'id:'+items.id" style="width: 40px">              <div class=" layui-unselect layui-form-checkbox x" lay-skin="primary" :data-id="items.id">                <i class="layui-icon">&#xe605;</i>              </div>            </td>            <td style="width:40px " @mouseover="MM_showHideLayers('product_pic',''+urlPrefix+items.picture+'','show')"            @mouseout="MM_showHideLayers('product_pic',urlPrefix+items.picture+'','hide')">            <img style="height: 45px;width: 32px" :src="urlPrefix+items.picture">            </td>            <td lay-sort="true">{{items.id}}</td>            <td lay-sort="true">{{items.createTime}}</td>            <td>{{items.name}}</td>            <td :class="items.num<=1?'x-red':''">{{items.num}}</td>            <td>{{items.price}}</td>            <td>{{items.gridByGridId.id}}</td>            <td>{{items.gridByGridId.name}}</td>            <td class="td-status">              <span class="layui-btn layui-btn-normal layui-btn-mini" v-if="items.status">已上架</span>              <span class="layui-btn layui-btn-disabled layui-btn-mini" v-else>已下架</span>            </td>            <td class="td-manage">              <a title="库存管理"  @click="editNum(items)" href="javascript:;">                <i class="layui-icon">&#xe654;</i>              </a>              <a title="打印条码"  @click="showBarcode(items)" href="javascript:;">                <i class="layui-icon layui-icon-print"></i>              </a>              <a :id="'status:'+items.id" @click="member_stop(items.id)" href="javascript:;"  :title="items.status?'下架':'上架'">                <i class="layui-icon" v-if="items.status">&#xe601;</i>                <i class="layui-icon" v-else>&#xe62f;</i>              </a>              <a title="编辑"  @click="edit(items)" href="javascript:;">                <i class="layui-icon">&#xe642;</i>              </a>              <a title="删除" @click="del(items.id)" href="javascript:;">                <i class="layui-icon">&#xe640;</i>              </a>            </td>          </tr>        </tbody>      </table>      <div class="page" v-show="paginate">        <a @click="getAll(pageNumber-2)">&lt;&lt;</a>        <input  v-model="pageNumber" @change="getAll(pageNumber-1)"/>/        <a>{{totalPages}}</a>        <a @click="getAll(pageNumber)">&gt;&gt;</a>      </div>    </div>    <script>        // import Paginate from '../../js/vue-paginate'        // Vue.component('paginate', VuePaginate);        const app = new Vue({            el: "#goods",            data: {                // Note 'isActive' is left out and will not appear in the rendered table                goods:[],                pageNumber:1,                pageSize:10,                first:'',                last:'',                totalElements:0,                totalPages:1,                name:'',                status:'',                gridName:'',                warning:false,                paginate:true,            },            // components: {            //   'paginate':VuePaginate            // },            computed:{            },//自动加载            mounted() {                this.getAll(0);                $('#all').html('<div class="layui-unselect layui-form-checkbox header " ' +                    'lay-skin="primary"><i class="layui-icon">&#xe605;</i></div>')            },            methods:{                getAll(pages) {                    if (pages>-1&&pages<this.totalPages||this.totalPages===0){                        axios.get(urlPrefix+'/goods?token=' + token, {                            params: {                                'page':pages,                                'name':this.name,                                'gridName':this.gridName,                                'status':this.status,                                'warning':this.warning                            }                        }).then((response) => {                            var r = response.data.data;                            this.goods=r.content;                            this.pageNumber=r.number+1;                            this.first=r.first;                            this.last=r.last;                            this.totalElements=r.totalElements;                            this.totalPages=r.totalPages;                            // alert(JSON.stringify(response.data.data))'                            this.paginate = this.totalElements>10;                        }).catch((err) => {                            errHandler(err);                        });                    }else if (pages<0&&!(this.first&&this.last)){                        layer.msg("已经是首页",{icon:0,time:1000});                    } else{                        if (!(this.first&&this.last)) {                            layer.msg("已经是尾页",{icon:0,time:1000});                        }                    }                },                reset(){                    this.status='';                    this.name='';                    this.gridName='';                }                ,                edit(obj){                    sessionStorage.setItem('goods', JSON.stringify(obj));                    x_admin_show('编辑','goods-edit.html',600,520,this.getAll,this.pageNumber-1);                },                editNum(obj){                    if (obj.status){                        sessionStorage.setItem('goods', JSON.stringify(obj));                        x_admin_show('库存管理','goods-num.html',480,360,this.getAll,this.pageNumber-1);                    } else layer.msg("该商品已下架，请上架后操作!",{icon:0,time:1000});                },                showBarcode(obj){                    sessionStorage.setItem('goods', JSON.stringify(obj));                    x_admin_show('条码打印','goods-barcode.html',480,300,this.getAll,this.pageNumber-1);                },                /*用户-删除*/                del(id){                  if (id!=null){                    layer.confirm('确认要删除吗，此操作将会删除包括此商品的所有数据？',function(index){                      //发异步删除数据                        axios.delete(urlPrefix+'/goods/'+id+'?token=' + token,                        ).then((response)=>{                            // var obj = document.getElementById("id:"+id).parentElement;                            // obj.remove();                            layer.msg('已删除!',{icon:1,time:1000});                            app.getAll(0);                            $('.x').removeClass('layui-form-checked');                        }).catch((err)=>                        {                            errHandler(err)                        })                    });                 }                },                //批量删除                delAll () {                var data = tableCheck.getData();                // alert(JSON.stringify(data));                if (data.length!=0) {                    layer.confirm('确认要删除吗，此操作将会删除包括此商品的所有数据？',function(index){                        axios.delete(urlPrefix+'/goods?token=' + token, {data}                        ).then((response) => {                            //捉到所有被选中的，发异步进行删除                            layer.msg('删除成功', {icon: 1});                            // $(".layui-form-checked").not('.header').parents('tr').remove();                            app.getAll(0);                            $('.x').removeClass('layui-form-checked');                        }).catch((err) => {                            errHandler(err);                        })                    });                }else  layer.msg('至少选中一项', {icon: 2});                },                /*用户-下架*/               member_stop(id){                   var obj = document.getElementById("status:"+id);                   // alert($(obj).attr('title'));                   var str = $(obj).attr('title');                    layer.confirm('确认要'+str+'吗？',function(index){                    if($(obj).attr('title')==='上架'){                    //发异步把用户状态进行更改                        axios.put(urlPrefix+'/goods/status/'+id+'/'+true+'?token=' + token).then((response)=>{                            //                            // $(obj).attr('title','下架');                            // $(obj).find('i').html('&#xe601;');                            // $(obj).parents("tr").find(".td-status").find('span').addClass('layui-btn-normal')                            //     .removeClass('layui-btn-disabled').html('已上架');                            if(response.data.data==1){                              app.getAll(0);                              layer.msg('已上架!',{icon: 6,time:1000});                            }else{                            layer.msg('此商品所在格子铺未被租赁，不可上架!',{icon: 5,time:1000});                        }                    }).catch((err)=>{                            errHandler(err)                    });                }else{                    axios.put(urlPrefix+'/goods/status/'+id+'/'+false+'?token=' + token).then((response)=>{                        // $(obj).attr('title','上架');                        // $(obj).find('i').html('&#xe62f;');                        // $(obj).parents("tr").find(".td-status").find('span').addClass('layui-btn-disabled').html('已下架');                        app.getAll(0);                        layer.msg('已下架!',{icon: 5,time:1000});                    }).catch((err)=>{                        errHandler(err)                    })                }            });        }        }        });      layui.use('laydate', function(){        var laydate = layui.laydate;        //执行一个laydate实例        laydate.render({            elem: '#start', //指定元素            format:'yyyy-MM-dd',            done:(value)=>{                app.start = value;            }        });        //执行一个laydate实例        laydate.render({            elem: '#end', //指定元素            format:'yyyy-MM-dd',            done:(value)=>{                app.start = value;            }        });      });    </script>  </body></html>
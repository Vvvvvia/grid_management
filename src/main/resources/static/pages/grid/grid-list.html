<html class="x-admin-sm"><head>  <meta charset="UTF-8">  <title>格子管理</title>  <meta name="renderer" content="webkit">  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">  <!--<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />-->  <link rel="stylesheet" href="../../css/font.css">  <link rel="stylesheet" href="../../css/xadmin.css">  <script type="text/javascript" src="../../js/jquery3.2.1.min.js"></script>  <script type="text/javascript" src="../../lib/layui/layui.js" charset="utf-8"></script>  <script type="text/javascript" src="../../js/xadmin.js"></script>  <script type="text/javascript" src="../../js/cookie.js"></script>  <script type="text/javascript" src="../../js/vue.min.js"></script>  <script type="text/javascript" src="../../js/axios.min.js"></script>  <!--<script type="text/javascript" src="../../js/vue-paginate.js"></script>-->  <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->  <!--[if lt IE 9]>  <script src="../../js/html5.min.js"></script>  <script src="../../js/respond.min.js"></script>  <![endif]--></head><body onload="tableCheck.init()"><div class="x-nav" ><span class="layui-breadcrumb"><a href="">首页</a><a href="">格子管理</a><a><cite>格子列表</cite></a></span>  <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">    <i class="layui-icon" style="line-height:30px">ဂ</i></a></div><div class="x-body" id="grid">  <div class="layui-row">    <div class=" layui-col-md12 x-so">      <select class="layui-select" v-model="status">        <option selected="selected" value="">请选择格子铺状态</option>        <option value="true">可租赁</option>        <option value="false">已租出</option>      </select>      <input type="text" v-model="name"  placeholder="请输入格子铺名称" autocomplete="off" class="layui-input">      <input type="text" v-model="shopName"  placeholder="请输入挂靠商铺名称" autocomplete="off" class="layui-input">      <button class="layui-btn"  @click="getAll(0)" title="搜索"><i class="layui-icon" >&#xe615;</i></button>      <button class="layui-btn" @click="reset()" title="重置"><i class="layui-icon" >&#xe669;</i></button>    </div>  </div>  <xblock>    <button class="layui-btn layui-btn-danger" @click="delAll()"><i class="layui-icon"></i>批量删除</button>    <button class="layui-btn" @click="location.href='./grid-add.html'">      <i class="layui-icon"></i>添加格子铺</button>    <span class="x-right" style="line-height:40px">共有数据：{{this.totalElements}} 条</span>  </xblock>  <table class="x-admin layui-table ">    <thead>    <tr>      <th id="all"></th>      <th>ID</th>      <th>格子铺名称</th>      <th>格子数量</th>      <th>挂靠商铺ID</th>      <th>商铺名称</th>      <th>商铺地址</th>      <th>商铺电话</th>      <th>状态</th>      <th>操作</th>    </tr>    </thead>    <tbody id="tbody">    <tr v-for="items in grids">      <td :id="'id:'+items.id">        <div class=" layui-unselect layui-form-checkbox x" lay-skin="primary" :data-id="items.id">          <i class="layui-icon">&#xe605;</i>        </div>      </td>      <td lay-sort="true">{{items.id}}</td>      <td>{{items.name}}</td>      <td>{{items.size}}</td>      <td>{{items.shopId}}</td>      <td>{{items.shopByShopId.name}}</td>      <td>{{items.shopByShopId.address}}</td>      <td>{{items.shopByShopId.phone}}</td>      <td class="td-status"><span class="layui-btn layui-btn-normal layui-btn-mini" title="进入租赁页面"      @click="showRentDetail(items)" v-if="items.status===true">可租赁</span>        <span class="layui-btn layui-btn-danger layui-btn-mini" title="查看租赁信息"              @click="showRentDetail(items)" v-else>已租出</span>      </td>      <td class="td-manage">        <a title="租赁记录"  @click="showRentRecords(items)" href="javascript:;">          <i class="layui-icon">&#xe62d;</i>        </a>        <!--<a title="租赁详情"  @click="showRentDetail(items)" href="javascript:;">-->          <!--<i class="layui-icon">&#xe629;</i>-->        <!--</a>-->        <!--<a title="解除租赁" :id="'status:'+items.id" @click="rentStop(items)" href="javascript:;">-->          <!--<i class="layui-icon">&#xe673;</i>-->        <!--</a>-->        <a title="编辑"  @click="edit(items)" href="javascript:;">          <i class="layui-icon">&#xe642;</i>        </a>        <a title="删除" @click="del(items)" href="javascript:;">          <i class="layui-icon">&#xe640;</i>        </a>      </td>    </tr>    </tbody>  </table>  <div class="page" v-show="paginate">    <a @click="getAll(pageNumber-2)">&lt;&lt;</a>    <input  v-model="pageNumber" @change="getAll(pageNumber-1)"/>/    <a>{{totalPages}}</a>    <a @click="getAll(pageNumber)">&gt;&gt;</a>  </div></div><script>    const app = new Vue({        el: "#grid",        data: {// Note 'isActive' is left out and will not appear in the rendered table            grids:[],            pageNumber:1,            pageSize:10,            first:'',            last:'',            totalElements:0,            totalPages:1,            name:'',            shopName:'',            status:'',            paginate:true,        },//自动加载        mounted() {            this.getAll(0);            $('#all').html('<div class="layui-unselect layui-form-checkbox header " ' +                'lay-skin="primary"><i class="layui-icon">&#xe605;</i></div>')        },        methods:{            getAll(pages) {                if (pages>-1&&pages<this.totalPages||this.totalPages===0){                    axios.get(urlPrefix+'/grids/?token=' + token, {                        params: {                            'page':pages,                            'name':this.name,                            'shopName':this.shopName,                            'status':this.status                        }                    }).then((response) => {                        var r = response.data.data;                        this.grids = r.content;                        this.pageNumber=r.number+1;                        this.first=r.first;                        this.last=r.last;                        this.totalElements=r.totalElements;                        this.totalPages=r.totalPages;// alert(JSON.stringify(response.data.data))'                        this.paginate = this.totalElements>10;                    }).catch((err) => {                        errHandler(err);                    });                }else if (pages<0&&!(this.first&&this.last)){                    layer.msg("已经是首页",{icon:0,time:1000});                } else{                    if (!(this.first&&this.last)) {                        layer.msg("已经是尾页",{icon:0,time:1000});                    }                }            },            reset(){                this.name='';                this.status='';                this.shopName='';            }            ,            edit(obj){                sessionStorage.setItem('grid', JSON.stringify(obj));                window.location.href='grid-edit.html';            },            showRentDetail(item){                if (item.rentId==null){                    layer.confirm('该格子还未被租赁，是否租赁？',{icon:0},function(){//发异步删除数据                        layer.closeAll('dialog');                        sessionStorage.setItem('grid', JSON.stringify(item));                        window.location.href='grid-rentPage.html'                    });                }else {                    sessionStorage.setItem('rentId', JSON.stringify(item.rentId));                    x_admin_show('租赁详情','grid-rentDetail.html',700,500,this.getAll,this.pageNumber-1);                }            },            showRentRecords(item){                sessionStorage.setItem('grid', JSON.stringify(item));                x_admin_show('租赁记录','grid-rentRecords.html',900,700,this.getAll,this.pageNumber-1);            },            /*用户-删除*/            del(item){                if (item!=null){                    if (item.status){                        layer.confirm('确认要删除吗？',function(index){//发异步删除数据                            axios.delete(urlPrefix+'/grids/'+item.id+'?token=' + token,                            ).then((response)=>{                                if (response.data.data){                                    layer.msg('删除成功!',{icon:1,time:1000});                                    app.getAll(0);                                    $('.x').removeClass('layui-form-checked');                                } else {                                    layer.alert('删除失败，请检查状态!',{icon:2});                                }                            }).catch((err)=>                            {                                errHandler(err)                            })                        });                    } else layer.alert('删除失败，请检查状态!',{icon:2});                }            },//批量删除            delAll () {                var data = tableCheck.getData();// alert(JSON.stringify(data));                if (data.length!=0) {                    layer.confirm('确认要删除吗？',function(index){                        axios.delete(urlPrefix+'/grids?token=' + token, {data}                        ).then((response) => {                            if (response.data.data){//捉到所有被选中的，发异步进行删除                                layer.msg('删除成功', {icon: 1});// $(".layui-form-checked").not('.header').parents('tr').remove();                                app.getAll(0);                                $('.x').removeClass('layui-form-checked');                            }                            else layer.alert('删除失败,请检查状态', {icon: 2});                        }).catch((err) => {                            errHandler(err);                        })                    });                }else  layer.msg('至少选中一项', {icon: 2});            },        }    });    layui.use('laydate', function(){        var laydate = layui.laydate;        //执行一个laydate实例        laydate.render({            elem: '#start', //指定元素            format:'yyyy-MM-dd',            done:(value)=>{                // app.start = value;            }        });        //执行一个laydate实例        laydate.render({            elem: '#end', //指定元素            format:'yyyy-MM-dd',            done:(value)=>{                // app.start = value;            }        });    });</script></body></html>